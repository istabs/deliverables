<!doctype html>
<html lang=pt>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>IST delivery schedule</title>
	<meta name="description" content="IST deliverables">
	<meta name="author" content="ABS">

	<!-- IMPORTS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.4.3/css/tabulator.min.css" rel="stylesheet">
	<style>
		.tabulator .tabulator-header .tabulator-col .tabulator-col-content .tabulator-col-title {
			white-space: normal;
		}
		h1 {
			line-height: 1.5em;
		}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sprintf/1.1.2/sprintf.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.4.3/js/tabulator.min.js">
	</script>

	<!-- PARAMETERS -->
	<script>
		var deliverables = [

			{ "uc": "EA", "deliverable": "Homework Bonus #01", "type": "homework", "startDate": "2020/02/19 00:01", "dueDate": "2020/03/01 23:59", },
			{ "uc": "EA", "deliverable": "Homework Bonus #02", "type": "homework", "startDate": "2020/03/03 00:01", "dueDate": "2020/03/08 23:59", },
			{ "uc": "EA", "deliverable": "Homework Bonus #03", "type": "homework", "startDate": "2020/03/11 00:01", "dueDate": "2020/03/15 23:59", },
			{ "uc": "EA", "deliverable": "Homework Bonus #04", "type": "homework", "startDate": "2020/03/17 15:00", "dueDate": "2020/03/22 23:59", },
			{ "uc": "EA", "deliverable": "Homework Bonus #05", "type": "homework", "startDate": "2020/03/24 14:00", "dueDate": "2020/03/29 23:59", },

			{ "uc": "EA", "deliverable": "Project: Additional Questions", "type": "project", "startDate": "2020/03/04 12:00", "dueDate": "2020/03/13 23:59", },
			{ "uc": "EA", "deliverable": "Project: 1st delivery", "type": "project", "startDate": "2020/03/04 12:00", "dueDate": "2020/04/03 23:59", },
			{ "uc": "EA", "deliverable": "Project: Final delivery", "type": "project", "startDate": "2020/04/10 12:00", "dueDate": "2020/05/15 23:59", },
			{ "uc": "EA", "deliverable": "Project: Presentation", "type": "project", "startDate": "2020/05/16 12:00", "dueDate": "2020/05/19 13:00", },
			
			{ "uc": "EA", "deliverable": "Teste: 1º Teste", "type": "exam", "dueDate": "2020/04/17 18:00", "end": "20:00", "room": "A1", },
			{ "uc": "EA", "deliverable": "Teste: 2º Teste", "type": "exam", "dueDate": "2020/05/27 18:00", "end": "20:00", "room": "A1", },
			{ "uc": "EA", "deliverable": "Teste: Repescagem", "type": "exam", "dueDate": "2020/07/03 11:30", "end": "14:30", "room": "0 - 16", },

			{ "uc": "EA", "deliverable": "Exame: Época Especial", "type": "exam", "dueDate": "2020/07/23 11:30", "end": "14:30", "room": "1 - 4", },
			{ "uc": "EA", "deliverable": "Exame: Época Especial", "type": "exam", "dueDate": "2020/07/23 11:30", "end": "14:30", "room": "F2", },

			{ "uc": "ISM", "deliverable": "Case A", "type": "homework", "startDate": "2020/02/17 13:00", "dueDate": "2020/02/22 13:00", },
			{ "uc": "ISM", "deliverable": "Case A review", "type": "homework", "startDate": "2020/02/23 08:00", "dueDate": "2020/02/24 23:59", },
			{ "uc": "ISM", "deliverable": "Case B", "type": "homework", "startDate": "2020/02/24 13:00", "dueDate": "2020/02/29 13:00", },
			{ "uc": "ISM", "deliverable": "Case B review", "type": "homework", "startDate": "2020/03/01 08:00", "dueDate": "2020/03/02 13:00", },
			{ "uc": "ISM", "deliverable": "Case C", "type": "homework", "startDate": "2020/03/02 13:00", "dueDate": "2020/03/07 13:00", },
			{ "uc": "ISM", "deliverable": "Case C review", "type": "homework", "startDate": "2020/03/08 08:00", "dueDate": "2020/03/09 13:00", },
			{ "uc": "ISM", "deliverable": "Case D", "type": "homework", "startDate": "2020/03/09 13:00", "dueDate": "2020/03/14 13:00", },
			{ "uc": "ISM", "deliverable": "Case D review", "type": "homework", "startDate": "2020/03/15 08:00", "dueDate": "2020/03/16 13:00", },
			{ "uc": "ISM", "deliverable": "Case E", "type": "homework", "startDate": "2020/03/16 13:00", "dueDate": "2020/03/21 13:00", },
			{ "uc": "ISM", "deliverable": "Case E review", "type": "homework", "startDate": "2020/03/22 08:00", "dueDate": "2020/03/24 23:59", },
			{ "uc": "ISM", "deliverable": "Case F", "type": "homework", "startDate": "2020/03/23 13:00", "dueDate": "2020/03/28 13:00", },
			{ "uc": "ISM", "deliverable": "Case F review", "type": "homework", "startDate": "2020/03/29 08:00", "dueDate": "2020/03/31 23:59", },
			{ "uc": "ISM", "deliverable": "Case G", "type": "homework", "startDate": "2020/04/13 13:00", "dueDate": "2020/04/18 13:00", },
			{ "uc": "ISM", "deliverable": "Case G review", "type": "homework", "startDate": "2020/04/19 08:00", "dueDate": "2020/04/21 23:59", },
			{ "uc": "ISM", "deliverable": "Case H", "type": "homework", "startDate": "2020/04/20 13:00", "dueDate": "2020/04/25 13:00", },
			{ "uc": "ISM", "deliverable": "Case H review", "type": "homework", "startDate": "2020/04/26 08:00", "dueDate": "2020/04/28 23:59", },
			{ "uc": "ISM", "deliverable": "Case I", "type": "homework", "startDate": "2020/05/04 13:00", "dueDate": "2020/05/09 13:00", },
			{ "uc": "ISM", "deliverable": "Case I review", "type": "homework", "startDate": "2020/05/10 08:00", "dueDate": "2020/05/12 23:59", },
			{ "uc": "ISM", "deliverable": "Case FINAL", "type": "homework", "startDate": "2020/05/11 13:00", "dueDate": "2020/05/21 18:30", },
			{ "uc": "ISM", "deliverable": "Case FINAL review", "type": "homework", "startDate": "2020/05/24 08:00", "dueDate": "2020/05/26 23:59", },

			{ "uc": "ISM", "deliverable": "Project: Phase 1 - Assignment 1", "type": "project", "startDate": "2020/03/19 15:30", "dueDate": "2020/04/04 13:00", },
			{ "uc": "ISM", "deliverable": "Project: Phase 2 - Assignment 2", "type": "project", "startDate": "2020/04/04 15:30", "dueDate": "2020/05/02 13:00", },
			{ "uc": "ISM", "deliverable": "Project: Phase 3 - Assignment 3", "type": "project", "startDate": "2020/05/02 15:30", "dueDate": "2020/05/27 13:00", },
			{ "uc": "ISM", "deliverable": "Project: WORKSHOP", "type": "project", "startDate": "2020/05/28 15:30", "dueDate": "2020/05/28 18:30", },

			{ "uc": "ISM", "deliverable": "Exame: Época Especial", "type": "exam", "dueDate": "2020/07/22 11:30", "end": "14:30", "room": "1 - 11", },
			{ "uc": "DS", "deliverable": "Exame: Época Especial", "type": "exam", "dueDate": "2020/07/17 9:00", "end": "11:00", "room": "N.D.", },
		]
	</script>
</head>

<body>
	<div class="container-fluid">
		<h1>IST/MEIC ABS delivery schedule</h1>

		<div id="dropScheduleHere"></div>
	</div>

	<!-- JAVASCRIPT FUNCTIONS -->
	<script>
		Date.prototype.diff = function (until) {
			var _day_ms = 86400000;
			var _from_ms = this.getTime();
			var _until_ms = until.getTime();
			var _ms_diff = _until_ms - _from_ms;
			return Math.round(_ms_diff / _day_ms);
		}

		Date.prototype.getMonthNr = function () {
			return this.getMonth() + 1
		}

		Date.prototype.getWeekNr = function () {
			var date = new Date(this)
			date.setHours(0, 0, 0, 0);
			date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
			var week1 = new Date(date.getFullYear(), 0, 4);
			return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 -
				3 + (week1.getDay() + 6) % 7) / 7);
		}

		Date.prototype.getWeekDay = function () {
			var weekdays = new Array("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat");
			return weekdays[this.getDay()];
		}

		Date.getMonthDaysLeft = function (date) {
			var _year = date.getFullYear()
			var _month = date.getMonth()
			var _endOfMonth = new Date();
			_endOfMonth.setFullYear(_year, _month + 1, 0)
			return _endOfMonth.getDate() - date.getDate() + 1
		}

		Date.daysArray = function (date) {
			var year = date.getFullYear()
			var month = date.getMonth()
			var day = date.getDate()
			var _days = []
			var _targetDate = new Date();
			_targetDate.setFullYear(year, month + 1, 0)
			var _actualDate = new Date();
			_actualDate.setFullYear(year, month, day)
			var d = 0
			while (_targetDate >= _actualDate) {
				_days[d] = new Date();
				_days[d].setFullYear(_actualDate.getFullYear(), _actualDate.getMonth(), _actualDate.getDate())
				d = d + 1
				_actualDate.setDate(_actualDate.getDate() + 1)
			}
			return _days
		}
		
	</script>
	<script>
		fetch("#/2020_2.json").then(function(resp) {
			console.log(resp);
		});
	</script>
	<script>
		var normalizeTimer = function (data) {
			var _maxTimer = 0
			for (i = 0; i < data.length; i++) {
				if (data[i].timer > _maxTimer) {
					_maxTimer = data[i].timer
				}
			}
			for (i = 0; i < data.length; i++) {
				data[i].timer = data[i].timer / _maxTimer * 100
			}
			return data
		}

		var extractData = function (deliverables) {
			var _data = []
			for (i = 0; i < deliverables.length; i++) {
				var _dueDate = new Date(deliverables[i].dueDate)
				var _dueDateString = sprintf('%04d/%02d/%02d %02d:%02d (w%s, %s)', _dueDate.getFullYear(), _dueDate
					.getMonthNr(),
					_dueDate.getDate(), _dueDate.getHours(), _dueDate.getMinutes(), _dueDate.getWeekNr(), _dueDate
					.getWeekDay())
				var _deltaDays = new Date().diff(_dueDate)
				if (_deltaDays >= 0)
					_data.push({
						uc: deliverables[i].uc,
						deliverable: deliverables[i].deliverable,
						type: deliverables[i].type,
						days: _deltaDays,
						timer: _deltaDays,
						dueDate: _dueDateString
					})
			}
			normalizeTimer(_data)
			return _data
		}

		var tabulator = new Tabulator("#dropScheduleHere", {
			layout: "fitDataFill",
			data: extractData(deliverables),
			tooltips: false,
			movableColumns: true,
			responsiveLayout: "hide",
			height: 560,
			initialSort: [{
				column: "timer",
				dir: "asc"
			}],
			columns: [
				{ title: "UC", field: "uc", width: 60, headerFilter: true, },
				{ title: "Deliverable", field: "deliverable", },
				{ title: "Deliverable Type", field: "type", width: 112, },
				{ title: "Due date", field: "dueDate", },
				{ title: "Days left", field: "days", align: "right", width: 75, },
				{ title: "Timer", field: "timer", minWidth: 280, formatter: "progress", align: "right", },
			],
		});
	</script>

</body>

</html>